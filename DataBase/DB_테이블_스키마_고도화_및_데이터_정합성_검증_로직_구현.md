# [DB] 스터디룸 예약 시스템 테이블 설계 고도화 및 데이터 정합성 개선

## 1. 개요 (Context)
2026-02-20 진행된 스터디룸 예약 시스템 미니 프로젝트의 데이터베이스 설계 및 구현 과정을 기록한 것입니다. 단순한 테이블 생성을 넘어 실무 운영에서 발생할 수 있는 데이터 타입 이슈와 성능 최적화(역정규화)를 다룹니다.

---

## 2. 상세 작업 내용 (Detailed Content)

###  테이블 스키마 확장 및 관리자 관점 설계
* **운영 상태 관리**: 스터디룸의 예약 가능 여부를 제어하기 위해 `is_active` 필드를 도입하였습니다.
* **데이터 추적성 확보**: 모든 모델에 `created_at` 타임스탬프를 적용하여 데이터 생성 시점을 추적하도록 설계했습니다.
* **사용자 권한 세분화**: 일반 사용자(`user`)와 관리자(`admin`)를 구분하는 `role` 필드를 `User` 테이블에 추가했습니다.

###  비즈니스 로직에 따른 데이터 가공
* **날짜/시간 분리 저장**: Pydantic에서 전달되는 단일 `datetime` 객체를 DB의 `Date`와 `Time` 컬럼에 맞게 분리하여 저장하는 로직을 Service 계층에 구현했습니다.
* **부분 업데이트(PATCH) 적용**: DB 부하를 줄이고 데이터 오염을 방지하기 위해 필요한 필드만 골라 수정하는 `PATCH` 메서드를 활용했습니다.

---

## 3. 트러블슈팅 및 해결 (Troubleshooting)

###  Issue: 데이터 직렬화(Serialization) 에러
* **상황**: API 요청 시 받은 날짜 형식이 DB 컬럼 타입과 일치하지 않아 저장 실패(ResponseValidationError).
* **해결**: `.date()`와 `.time()` 메서드를 사용해 데이터를 정규화한 후 저장하는 전처리 과정을 추가하여 해결했습니다.

###  Issue: 조회 성능 최적화 의사결정
* **상황**: 리뷰 조회 시마다 발생하는 다중 Join에 따른 성능 저하 우려.
* **해결**: `Review` 테이블에 `user_id`와 `room_id`를 중복 저장하는 **역정규화(Denormalization)**를 선택하여 조회 성능을 높였습니다.

---

## 4. 향후 계획 (Future Work)
* **보안 강화**: `bcrypt`를 이용한 비밀번호 해싱 및 JWT 인증 시스템 구축 예정.
* **비동기 처리**: 시스템 전반을 `Async/Await` 구조로 전환하여 동시 접속 처리 능력 향상.