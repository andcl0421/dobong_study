#### [2026-01-26] SQL 기초 및 중급 집계/필터링 실습 정리

---

### 1. 오늘 학습 요약 (핵심 정리)
- `world` 및 `dvdrental` 샘플 데이터베이스를 활용하여 실무 중심의 SQL 쿼리 작성 실습
- 데이터를 그룹화하고 통계치를 산출하는 `GROUP BY`와 `집계 함수` 마스터
- 필터링의 두 축인 `WHERE`와 `HAVING`의 사용 시점과 차이점 정복

---

### 2. 배운 개념 정리
- **WHERE vs HAVING**: `WHERE`는 그룹화 전 개별 데이터를, `HAVING`은 그룹화 후 집계 결과를 필터링함
- **DISTINCT**: 중복된 값을 제거하고 유니크한 항목만 추출
- **IN 연산자**: 여러 `OR` 조건을 하나로 묶어 가독성 높게 필터링 (`rating IN ('PG', 'G')`)
- **비교 연산자**: 작거나 같다(`<=`), 크거나 같다(`>=`)의 기호 순서 주의

---

### 3. 오늘 작성한 주요 코드 리뷰 (실전 코드)

```sql
/* 등급별 평균 대여료가 3달러 미만인 등급 조회
   - 집계된 결과(AVG)를 필터링해야 하므로 HAVING 사용
*/
SELECT 
    rating AS 등급, 
    AVG(rental_rate) AS 평균대여료
FROM film
GROUP BY rating
HAVING AVG(rental_rate) < 3;

/* 복합 필터링: 특정 등급이면서 대여 기간 조건 만족하는 영화 조회
   - 문자열은 홑따옴표(''), 비교 연산자는 <= 순서 준수
*/
SELECT 
    title AS 영화제목, 
    rating AS 영화관람등급, 
    rental_duration AS 대여가능기간
FROM film
WHERE rating IN ('PG', 'G')         
  AND rental_duration <= 4;
```

---

### 4. 실수/에러와 해결 과정
- **문제**: `WHERE AVG(population) > 1000`처럼 WHERE에 집계 함수를 써서 에러 발생
- **원인**: SQL 실행 순서상 `WHERE`는 집계 계산이 끝나기 전에 먼저 실행되기 때문임
- **해결**: 그룹화 이후에 필터링하는 `HAVING` 절로 옮겨서 해결
- **문제**: 문자열 비교 시 `==` 또는 `" "` 사용
- **해결**: SQL 표준인 `=` 하나와 홑따옴표(`' '`) 사용법으로 교정

---

### 5. 실무/RAG 관점의 참견 적용
- **데이터 분석 능력**: 단순히 데이터를 뽑는 것을 넘어 "수익성이 낮은 그룹"을 `HAVING`으로 찾아내는 등의 비즈니스 통찰력 확보가 중요함
- **RAG 시스템 설계**: 사용자의 자연어 질문을 SQL로 변환할 때, `rental_rate`(비용)와 `rental_duration`(기간) 같은 유사한 컬럼명을 정확히 매칭하는 것이 시스템 성능의 핵심임